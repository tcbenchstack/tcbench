
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../tcbench_modeling_losses/">
      
      
        <link rel="next" href="../tcbench_modeling_utils/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>methods - paper#132</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/style.css">
    
      <link rel="stylesheet" href="../../../css/material.css">
    
      <link rel="stylesheet" href="../../../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/fonts.css">
    
      <link rel="stylesheet" href="../../../css/tables_style.css">
    
      <link rel="stylesheet" href="../../../css/jupyter-notebook.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tcbench.modeling.methods" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="paper#132" class="md-header__button md-logo" aria-label="paper#132" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            paper#132
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              methods
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="paper#132" class="md-nav__button md-logo" aria-label="paper#132" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    paper#132
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Submission
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Submission
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../artifacts/" class="md-nav__link">
        Artifacts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../paper_tables_and_figures/reference/" class="md-nav__link">
        Tables and figures
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../quick_tour/" class="md-nav__link">
        Quick tour
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Datasets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Datasets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/install/" class="md-nav__link">
        Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/metadata/" class="md-nav__link">
        Meta-data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/import/" class="md-nav__link">
        Import/Delete
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/tutorial_load_parquet/" class="md-nav__link">
        Tutorial - Load parquet files
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Modeling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Modeling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../modeling/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../modeling/exploring_artifacts/" class="md-nav__link">
        Exploring ML artifacts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../modeling/runs/" class="md-nav__link">
        Runs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../modeling/campaigns/" class="md-nav__link">
        Campaigns
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          tcbench
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          tcbench
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
          cli
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2_1">
          <span class="md-nav__icon md-icon"></span>
          cli
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_cli_clickutils/" class="md-nav__link">
        clickutils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_cli_command_aimrepo/" class="md-nav__link">
        command_aimrepo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_cli_command_campaign/" class="md-nav__link">
        command_campaign
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_cli_command_datasets/" class="md-nav__link">
        command_datasets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_cli_command_singlerun/" class="md-nav__link">
        command_singlerun
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_cli_richutils/" class="md-nav__link">
        richutils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
          libtcdatasets
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2_2">
          <span class="md-nav__icon md-icon"></span>
          libtcdatasets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_datasets_utils/" class="md-nav__link">
        datasets_utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_ucdavis_icdm19_csv_to_parquet/" class="md-nav__link">
        ucdavis_icdm19_csv_to_parquet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_tcbench_ucdavis_icdm19_generate_splits/" class="md-nav__link">
        ucdavis_icdm19_generate_splits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_mirage19_json_to_parquet/" class="md-nav__link">
        mirage19_json_to_parquet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_mirage19_generate_splits.md" class="md-nav__link">
        mirage19_generate_splits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_mirage22_json_to_parquet/" class="md-nav__link">
        mirage22_json_to_parquet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_tcbench_mirage22_generate_splits/" class="md-nav__link">
        mirage22_generate_splits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_utmobilenet21_csv_to_parquet/" class="md-nav__link">
        utmobilenet21_csv_to_parquet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_libtcdatasets_tcbench_utmobilenet21_generate_splits/" class="md-nav__link">
        utmobilenet21_generate_splits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5_2_3" id="__nav_5_2_3_label" tabindex="0">
          modeling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_5_2_3">
          <span class="md-nav__icon md-icon"></span>
          modeling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_augmentation/" class="md-nav__link">
        augmentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_aimutils/" class="md-nav__link">
        aimutils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_backbone/" class="md-nav__link">
        backbone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_dataprep/" class="md-nav__link">
        dataprep
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_losses/" class="md-nav__link">
        losses
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          methods
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        methods
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods" class="md-nav__link">
    tcbench.modeling.methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss" class="md-nav__link">
    PatienceMonitorLoss
  </a>
  
    <nav class="md-nav" aria-label="PatienceMonitorLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.is_improved" class="md-nav__link">
    is_improved()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.is_expired" class="md-nav__link">
    is_expired()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.get_best_metrics" class="md-nav__link">
    get_best_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy" class="md-nav__link">
    PatienceMonitorAccuracy
  </a>
  
    <nav class="md-nav" aria-label="PatienceMonitorAccuracy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.is_improved" class="md-nav__link">
    is_improved()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.is_expired" class="md-nav__link">
    is_expired()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.get_best_metrics" class="md-nav__link">
    get_best_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer" class="md-nav__link">
    SimpleTrainer
  </a>
  
    <nav class="md-nav" aria-label="SimpleTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.log_msg" class="md-nav__link">
    log_msg()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer._reset_metrics" class="md-nav__link">
    _reset_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer._track_metrics" class="md-nav__link">
    _track_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer._do_epoch" class="md-nav__link">
    _do_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.train_one_epoch" class="md-nav__link">
    train_one_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.train_loop" class="md-nav__link">
    train_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.test_loop" class="md-nav__link">
    test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer" class="md-nav__link">
    XGboostTrainer
  </a>
  
    <nav class="md-nav" aria-label="XGboostTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.log_msg" class="md-nav__link">
    log_msg()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer._reset_metrics" class="md-nav__link">
    _reset_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer._track_metrics" class="md-nav__link">
    _track_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer._do_epoch" class="md-nav__link">
    _do_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.train_one_epoch" class="md-nav__link">
    train_one_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.train_loop" class="md-nav__link">
    train_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.test_loop" class="md-nav__link">
    test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer" class="md-nav__link">
    ContrastiveLearningTrainer
  </a>
  
    <nav class="md-nav" aria-label="ContrastiveLearningTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.prepare_net_for_train" class="md-nav__link">
    prepare_net_for_train()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.init_train" class="md-nav__link">
    init_train()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer._do_epoch" class="md-nav__link">
    _do_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.train_one_epoch" class="md-nav__link">
    train_one_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.train_loop" class="md-nav__link">
    train_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.test_loop" class="md-nav__link">
    test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.MonolithicTrainer" class="md-nav__link">
    MonolithicTrainer
  </a>
  
    <nav class="md-nav" aria-label="MonolithicTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.MonolithicTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer" class="md-nav__link">
    SimCLRTrainer
  </a>
  
    <nav class="md-nav" aria-label="SimCLRTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.init_pretrain" class="md-nav__link">
    init_pretrain()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.pretrain_loop" class="md-nav__link">
    pretrain_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.prepare_net_for_finetune" class="md-nav__link">
    prepare_net_for_finetune()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.init_finetune" class="md-nav__link">
    init_finetune()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.finetune_loop" class="md-nav__link">
    finetune_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.finetune_test_loop" class="md-nav__link">
    finetune_test_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.pretrain_test_loop" class="md-nav__link">
    pretrain_test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods._make_deterministic" class="md-nav__link">
    _make_deterministic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods._reset_optimizer" class="md-nav__link">
    _reset_optimizer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.trainer_factory" class="md-nav__link">
    trainer_factory()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_run_augmentations_at_loading/" class="md-nav__link">
        run_augmentations_at_loading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_run_augmentations_at_loading_xgboost/" class="md-nav__link">
        run_augmentations_at_loading_xgboost
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_run_contrastive_learning_and_finetune/" class="md-nav__link">
        run_contrastive_learning_and_finetune
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_run_campaign_augmentations_at_loading/" class="md-nav__link">
        run_campaign_augmentations_at_loading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_run_campaign_augmentations_at_loading_xgboost/" class="md-nav__link">
        run_campaign_augmentations_at_loading_xgboost
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tcbench_modeling_run_campaign_contrastive_learning_and_finetune/" class="md-nav__link">
        run_campaign_contrastive_learning_and_finetune
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods" class="md-nav__link">
    tcbench.modeling.methods
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss" class="md-nav__link">
    PatienceMonitorLoss
  </a>
  
    <nav class="md-nav" aria-label="PatienceMonitorLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.is_improved" class="md-nav__link">
    is_improved()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.is_expired" class="md-nav__link">
    is_expired()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.get_best_metrics" class="md-nav__link">
    get_best_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorLoss.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy" class="md-nav__link">
    PatienceMonitorAccuracy
  </a>
  
    <nav class="md-nav" aria-label="PatienceMonitorAccuracy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.is_improved" class="md-nav__link">
    is_improved()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.is_expired" class="md-nav__link">
    is_expired()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.get_best_metrics" class="md-nav__link">
    get_best_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.PatienceMonitorAccuracy.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer" class="md-nav__link">
    SimpleTrainer
  </a>
  
    <nav class="md-nav" aria-label="SimpleTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.log_msg" class="md-nav__link">
    log_msg()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer._reset_metrics" class="md-nav__link">
    _reset_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer._track_metrics" class="md-nav__link">
    _track_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer._do_epoch" class="md-nav__link">
    _do_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.train_one_epoch" class="md-nav__link">
    train_one_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.train_loop" class="md-nav__link">
    train_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimpleTrainer.test_loop" class="md-nav__link">
    test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer" class="md-nav__link">
    XGboostTrainer
  </a>
  
    <nav class="md-nav" aria-label="XGboostTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.log_msg" class="md-nav__link">
    log_msg()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer._reset_metrics" class="md-nav__link">
    _reset_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer._track_metrics" class="md-nav__link">
    _track_metrics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer._do_epoch" class="md-nav__link">
    _do_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.train_one_epoch" class="md-nav__link">
    train_one_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.train_loop" class="md-nav__link">
    train_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.XGboostTrainer.test_loop" class="md-nav__link">
    test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer" class="md-nav__link">
    ContrastiveLearningTrainer
  </a>
  
    <nav class="md-nav" aria-label="ContrastiveLearningTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.prepare_net_for_train" class="md-nav__link">
    prepare_net_for_train()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.init_train" class="md-nav__link">
    init_train()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer._do_epoch" class="md-nav__link">
    _do_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.train_one_epoch" class="md-nav__link">
    train_one_epoch()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.train_loop" class="md-nav__link">
    train_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.ContrastiveLearningTrainer.test_loop" class="md-nav__link">
    test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.MonolithicTrainer" class="md-nav__link">
    MonolithicTrainer
  </a>
  
    <nav class="md-nav" aria-label="MonolithicTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.MonolithicTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer" class="md-nav__link">
    SimCLRTrainer
  </a>
  
    <nav class="md-nav" aria-label="SimCLRTrainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.init_pretrain" class="md-nav__link">
    init_pretrain()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.pretrain_loop" class="md-nav__link">
    pretrain_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.prepare_net_for_finetune" class="md-nav__link">
    prepare_net_for_finetune()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.init_finetune" class="md-nav__link">
    init_finetune()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.finetune_loop" class="md-nav__link">
    finetune_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.finetune_test_loop" class="md-nav__link">
    finetune_test_loop()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.SimCLRTrainer.pretrain_test_loop" class="md-nav__link">
    pretrain_test_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods._make_deterministic" class="md-nav__link">
    _make_deterministic()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods._reset_optimizer" class="md-nav__link">
    _reset_optimizer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tcbench.modeling.methods.trainer_factory" class="md-nav__link">
    trainer_factory()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                




                  


  <h1>methods</h1>

<div class="doc doc-object doc-module">


<a id="tcbench.modeling.methods"></a>
  <div class="doc doc-contents first">
  
      <p>This modules contains a set of classes 
used to handle training and inference,
namely Trainer objects</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.PatienceMonitorLoss" class="doc doc-heading">
        <code>PatienceMonitorLoss</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>A callable class implementing monitoring of
a loss metric</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>steps</code></td>
          <td>
          </td>
          <td><p>the maximum patience</p></td>
        </tr>
        <tr>
          <td><code>steps_left</code></td>
          <td>
          </td>
          <td><p>steps left before patience expires</p></td>
        </tr>
        <tr>
          <td><code>min_delta</code></td>
          <td>
          </td>
          <td><p>the minimum difference against
the best loss observed so far to
be considered as an improvement</p></td>
        </tr>
        <tr>
          <td><code>best_loss</code></td>
          <td>
          </td>
          <td><p>the best loss observed so far</p></td>
        </tr>
        <tr>
          <td><code>best_epoch</code></td>
          <td>
          </td>
          <td><p>teh epoch when the best loss was observed</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">class</span> <span class="nc">PatienceMonitorLoss</span><span class="p">:</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A callable class implementing monitoring of</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    a loss metric</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        steps: the maximum patience</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        steps_left: steps left before patience expires</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        min_delta: the minimum difference against</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            the best loss observed so far to</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            be considered as an improvement</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        best_loss: the best loss observed so far</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        best_epoch: teh epoch when the best loss was observed</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">min_delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            steps: the maximum patience</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            min_delta: the minimum difference against</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_delta</span> <span class="o">=</span> <span class="n">min_delta</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">def</span> <span class="nf">is_improved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loss</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns true if input loss differ</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        from the best observed loss by at least</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        min_delta&quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span> <span class="o">-</span> <span class="n">loss</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">return</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delta</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">def</span> <span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if steps_left == 0&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">def</span> <span class="nf">get_best_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dictionary with best loss and epoch observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">best_loss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span><span class="p">,</span> <span class="n">best_epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The input metrics is a dictionary expected to have</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        a &quot;loss&quot; key, and the related value is compared against</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        the best loss observed so far. Returns True if the</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        input loss is improved wrt the best loss observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improved</span><span class="p">(</span><span class="n">loss</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span> <span class="o">=</span> <span class="n">loss</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="n">idx_epoch</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorLoss.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">min_delta</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>steps</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the maximum patience</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>min_delta</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>the minimum difference against</p></td>
          <td>
                <code>0.001</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">min_delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        steps: the maximum patience</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        min_delta: the minimum difference against</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">min_delta</span> <span class="o">=</span> <span class="n">min_delta</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorLoss.is_improved" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_improved</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns true if input loss differ
from the best observed loss by at least
min_delta</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="k">def</span> <span class="nf">is_improved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loss</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns true if input loss differ</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    from the best observed loss by at least</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    min_delta&quot;&quot;&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span> <span class="o">-</span> <span class="n">loss</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">return</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_delta</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorLoss.is_expired" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_expired</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns True if steps_left == 0</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span> <span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if steps_left == 0&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorLoss.get_best_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_best_metrics</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a dictionary with best loss and epoch observed</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span>
<span class="normal"><a href="#__codelineno-0-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="k">def</span> <span class="nf">get_best_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dictionary with best loss and epoch observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">best_loss</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span><span class="p">,</span> <span class="n">best_epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorLoss.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The input metrics is a dictionary expected to have
a "loss" key, and the related value is compared against
the best loss observed so far. Returns True if the
input loss is improved wrt the best loss observed</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The input metrics is a dictionary expected to have</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    a &quot;loss&quot; key, and the related value is compared against</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    the best loss observed so far. Returns True if the</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    input loss is improved wrt the best loss observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improved</span><span class="p">(</span><span class="n">loss</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_loss</span> <span class="o">=</span> <span class="n">loss</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="n">idx_epoch</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.PatienceMonitorAccuracy" class="doc doc-heading">
        <code>PatienceMonitorAccuracy</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>A callable class implementing monitoring of
a performance metric</p>
<p>Attributes
    steps: the maximum patience
    steps_left: steps left before patience expires
    best_acc: the best loss observed so far
    best_epoch: the epoch when the best loss was observed
    acc_name: the name of the performance metric</p>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">class</span> <span class="nc">PatienceMonitorAccuracy</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A callable class implementing monitoring of</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    a performance metric</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Attributes</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        steps: the maximum patience</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        steps_left: steps left before patience expires</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        best_acc: the best loss observed so far</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        best_epoch: the epoch when the best loss was observed</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        acc_name: the name of the performance metric</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;acc&quot;</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            name: the name of the performance metric</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            steps: the maximum patience</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">acc_name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">def</span> <span class="nf">is_improved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the input accuracy is</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        higher than the best observed so far&quot;&quot;&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">return</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">def</span> <span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if steps_left == 0&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">def</span> <span class="nf">get_best_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dictionary with best loss and epoch observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;best_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">acc_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span><span class="p">,</span> <span class="s2">&quot;best_epoch&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span><span class="p">}</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The input metrics is a dictionary expected to have</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        a key with the same name provided when instanciating</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        the class. The related value is compared against</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        the best loss observed so far. Returns True if the</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        performance metric is improved wrt the best performance observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">acc</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">acc_name</span><span class="p">]</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improved</span><span class="p">(</span><span class="n">acc</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span> <span class="o">=</span> <span class="n">acc</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="n">idx_epoch</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorAccuracy.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;acc&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the name of the performance metric</p></td>
          <td>
                <code>&#39;acc&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>steps</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the maximum patience</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;acc&quot;</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        name: the name of the performance metric</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        steps: the maximum patience</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">acc_name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorAccuracy.is_improved" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_improved</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Return True if the input accuracy is
higher than the best observed so far</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="k">def</span> <span class="nf">is_improved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acc</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if the input accuracy is</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    higher than the best observed so far&quot;&quot;&quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">return</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorAccuracy.is_expired" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_expired</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns True if steps_left == 0</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="k">def</span> <span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns True if steps_left == 0&quot;&quot;&quot;</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">==</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorAccuracy.get_best_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_best_metrics</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns a dictionary with best loss and epoch observed</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="k">def</span> <span class="nf">get_best_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dictionary with best loss and epoch observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;best_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">acc_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span><span class="p">,</span> <span class="s2">&quot;best_epoch&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.PatienceMonitorAccuracy.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The input metrics is a dictionary expected to have
a key with the same name provided when instanciating
the class. The related value is compared against
the best loss observed so far. Returns True if the
performance metric is improved wrt the best performance observed</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The input metrics is a dictionary expected to have</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">    a key with the same name provided when instanciating</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    the class. The related value is compared against</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    the best loss observed so far. Returns True if the</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    performance metric is improved wrt the best performance observed&quot;&quot;&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">acc</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">acc_name</span><span class="p">]</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_improved</span><span class="p">(</span><span class="n">acc</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_acc</span> <span class="o">=</span> <span class="n">acc</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_epoch</span> <span class="o">=</span> <span class="n">idx_epoch</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps_left</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.SimpleTrainer" class="doc doc-heading">
        <code>SimpleTrainer</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>A base class offering functionality for
training and testing a supervised model</p>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">class</span> <span class="nc">SimpleTrainer</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A base class offering functionality for</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    training and testing a supervised model</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">optimizer</span><span class="p">:</span> <span class="n">pytorch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">criterion</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="p">):</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">            net: the architecture to use</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">            optimizer: the optimizer to use</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            criterion: the instance of the loss to use</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">            device: the device to use</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">            deterministic: see _make_deterministic()</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">            tracker: the AIM run on which register metrics</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">            logger: the logging reference</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">_make_deterministic</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">criterion</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">def</span> <span class="nf">log_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a message to file and echoes it</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        to the console&quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">def</span> <span class="nf">_reset_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to clean (before training)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        internal objects used for tracking metrics</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">def</span> <span class="nf">_track_metrics</span><span class="p">(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">        and testing to track loss and performance metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                    <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                <span class="p">)</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">def</span> <span class="nf">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">track_preds_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        and testing to perform forward (and backward) propagation</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">            data_loader: an instance of a pytorch DataLoader</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">            idx_epoch: the current epoch</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">            track_preds_targets: if True, return predicted and target labels</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">            A dictionary of metrics containing the measured average &quot;loss&quot; and &quot;acc&quot;.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            If track_preds_targets is True, the dictionary contains also the keys</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">           &quot;preds&quot; and &quot;targets&quot;, each mapped to a list of integer labels</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">cum_loss</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">samples</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="c1"># x can be a list if the data loader</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="c1"># is associated to a multi-view dataset</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="c1"># but in this context we are not using contrastive</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="c1"># learning, hence we concat the views</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="n">cum_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="n">samples</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="n">preds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="c1"># loss=cum_loss / (batch_idx+1),</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">loss</span><span class="o">=</span><span class="n">cum_loss</span> <span class="o">/</span> <span class="n">batch_idx</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">acc</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">samples</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the internal model to train, calls _do_epoch() and return the obtained metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        The entry point for triggering training</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            epochs: number of epochs to run</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">            train_loader: the data for training</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            val_loader: the data for validation</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">            patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">            quiet: if False, no message on the console is reported</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">            The best model obtained during training</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="n">context</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;optimizer cannot be None when training&quot;</span><span class="p">)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="k">if</span> <span class="n">backbone</span><span class="o">.</span><span class="n">has_dropout_layer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">):</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">WARNING: Detected Dropout layer!</span><span class="se">\n</span><span class="s2">WARNING: During supervised training, the monitored train_acc will be inaccurate</span><span class="se">\n</span><span class="s2">---&quot;</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="k">for</span> <span class="n">idx_epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>            <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="k">break</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="n">train_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_one_epoch</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epoch: </span><span class="si">{</span><span class="n">idx_epoch</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;train_loss: </span><span class="si">{loss:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">train_metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">])</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;train_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="k">if</span> <span class="n">val_loader</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="n">val_metrics</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                    <span class="n">val_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | val_loss: </span><span class="si">{loss:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">val_metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">])</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>                <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                    <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                    <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;val_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                    <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">):</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                    <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>                <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">):</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                    <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span><span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;run out of patience&quot;</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;reached max epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">set_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_model</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">def</span> <span class="nf">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="n">with_reports</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">        Run inference on a model (for testing or validation)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">            data_loader: the data to use</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">            idx_epoch: the current epoch</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">            with_reports: if True, compute classification report and confusion matrix</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">            A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">            during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">            and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">            was not requested</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="k">else</span> <span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                <span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">track_preds_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="n">preds</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">targets</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>        <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="k">if</span> <span class="n">with_reports</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">reports</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">class_rep</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                    <span class="n">classification_report</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">conf_mtx</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">)),</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the architecture to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>optimizer</code></td>
          <td>
                <code>pytorch.<span title="pytorch.optim">optim</span>.<span title="pytorch.optim.Optimizer">Optimizer</span></code>
          </td>
          <td><p>the optimizer to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>criterion</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>the instance of the loss to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>device</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the device to use</p></td>
          <td>
                <code>&#39;cuda:0&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>deterministic</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>see _make_deterministic()</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>tracker</code></td>
          <td>
                <code>aim.<span title="aim.Run">Run</span></code>
          </td>
          <td><p>the AIM run on which register metrics</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>logger</code></td>
          <td>
                <code>logging.<span title="logging.Logger">Logger</span></code>
          </td>
          <td><p>the logging reference</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">pytorch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">criterion</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="p">):</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        net: the architecture to use</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        optimizer: the optimizer to use</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        criterion: the instance of the loss to use</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        device: the device to use</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        deterministic: see _make_deterministic()</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        tracker: the AIM run on which register metrics</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        logger: the logging reference</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">_make_deterministic</span><span class="p">()</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">criterion</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer.log_msg" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Register a message to file and echoes it
to the console</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="k">def</span> <span class="nf">log_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a message to file and echoes it</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    to the console&quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer._reset_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_reset_metrics</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method to clean (before training)
internal objects used for tracking metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="k">def</span> <span class="nf">_reset_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to clean (before training)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    internal objects used for tracking metrics</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer._track_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method invoked during training, validation
and testing to track loss and performance metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="k">def</span> <span class="nf">_track_metrics</span><span class="p">(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    and testing to track loss and performance metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer._do_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">track_preds_targets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method invoked during training, validation
and testing to perform forward (and backward) propagation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>an instance of a pytorch DataLoader</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx_epoch</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the current epoch</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>track_preds_targets</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, return predicted and target labels</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>A dictionary of metrics containing the measured average "loss" and "acc".</p></td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>If track_preds_targets is True, the dictionary contains also the keys</p></td>
        </tr>
    </tbody>
  </table>
      <p>"preds" and "targets", each mapped to a list of integer labels</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="k">def</span> <span class="nf">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">track_preds_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    and testing to perform forward (and backward) propagation</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        data_loader: an instance of a pytorch DataLoader</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">        idx_epoch: the current epoch</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        track_preds_targets: if True, return predicted and target labels</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        A dictionary of metrics containing the measured average &quot;loss&quot; and &quot;acc&quot;.</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        If track_preds_targets is True, the dictionary contains also the keys</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">       &quot;preds&quot; and &quot;targets&quot;, each mapped to a list of integer labels</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="n">cum_loss</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="n">samples</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># x can be a list if the data loader</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="c1"># is associated to a multi-view dataset</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="c1"># but in this context we are not using contrastive</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="c1"># learning, hence we concat the views</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">cum_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">samples</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="n">preds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="c1"># loss=cum_loss / (batch_idx+1),</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">loss</span><span class="o">=</span><span class="n">cum_loss</span> <span class="o">/</span> <span class="n">batch_idx</span><span class="p">,</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">acc</span><span class="o">=</span><span class="mi">100</span> <span class="o">*</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">samples</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer.train_one_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_one_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Set the internal model to train, calls _do_epoch() and return the obtained metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the internal model to train, calls _do_epoch() and return the obtained metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer.train_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_loop</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patience_monitor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The entry point for triggering training</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>epochs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of epochs to run</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>train_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for training</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>val_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for validation</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>patience_monitor</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorLoss" href="#tcbench.modeling.methods.PatienceMonitorLoss">PatienceMonitorLoss</a> | <a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorAccuracy" href="#tcbench.modeling.methods.PatienceMonitorAccuracy">PatienceMonitorAccuracy</a></code>
          </td>
          <td><p>the instance of the patience monitor</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>quiet</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if False, no message on the console is reported</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>The best model obtained during training</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    The entry point for triggering training</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        epochs: number of epochs to run</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        train_loader: the data for training</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        val_loader: the data for validation</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        quiet: if False, no message on the console is reported</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        The best model obtained during training</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">context</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;optimizer cannot be None when training&quot;</span><span class="p">)</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="k">if</span> <span class="n">backbone</span><span class="o">.</span><span class="n">has_dropout_layer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">):</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">WARNING: Detected Dropout layer!</span><span class="se">\n</span><span class="s2">WARNING: During supervised training, the monitored train_acc will be inaccurate</span><span class="se">\n</span><span class="s2">---&quot;</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">for</span> <span class="n">idx_epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="k">break</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_one_epoch</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epoch: </span><span class="si">{</span><span class="n">idx_epoch</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> | &quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;train_loss: </span><span class="si">{loss:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">train_metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">])</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="k">continue</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;train_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="k">if</span> <span class="n">val_loader</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">val_metrics</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="n">val_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="p">)</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | val_loss: </span><span class="si">{loss:.6f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">val_metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">])</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>                <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>                <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;val_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">):</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>                <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span><span class="p">)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">):</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>                <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span><span class="p">)</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">is_expired</span><span class="p">():</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;run out of patience&quot;</span><span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;reached max epochs&quot;</span><span class="p">)</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">set_state_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best_model</span><span class="p">)</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimpleTrainer.test_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Run inference on a model (for testing or validation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx_epoch</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the current epoch</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>with_reports</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, compute classification report and confusion matrix</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with two dictionaries. The first contains the metrics collected
during inference; the second contains classification report (class_rep)
and confusion matrix (conf_mtx) or is empty {} if their computation
was not requested</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="k">def</span> <span class="nf">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>    <span class="n">with_reports</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">    Run inference on a model (for testing or validation)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">        data_loader: the data to use</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">        idx_epoch: the current epoch</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">        with_reports: if True, compute classification report and confusion matrix</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">        and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">        was not requested</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="k">else</span> <span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">track_preds_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="p">)</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="n">preds</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="n">targets</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">if</span> <span class="n">with_reports</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">reports</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">class_rep</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="n">classification_report</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">conf_mtx</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">)),</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.XGboostTrainer" class="doc doc-heading">
        <code>XGboostTrainer</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>A base class offering functionality for
training and testing a supervised model</p>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="k">class</span> <span class="nc">XGboostTrainer</span><span class="p">:</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A base class offering functionality for</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">    training and testing a supervised model</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="n">xgboost_model</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="n">net</span><span class="p">:</span><span class="n">Any</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">device</span><span class="p">:</span><span class="n">Any</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="p">):</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">            xgboost_model: XGboost model</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">            tracker: the AIM run on which register metrics</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">            logger: the logging reference</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span> <span class="o">=</span> <span class="n">xgboost_model</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="k">def</span> <span class="nf">log_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a message to file and echoes it</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">        to the console&quot;&quot;&quot;</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">def</span> <span class="nf">_reset_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to clean (before training)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">        internal objects used for tracking metrics</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">def</span> <span class="nf">_track_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">        and testing to track loss and performance metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">context</span><span class="p">))</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="k">def</span> <span class="nf">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">track_preds_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        and testing to perform forward (and backward) propagation</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">            data_loader: an instance of a pytorch DataLoader</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">            track_preds_targets: if True, return predicted and target labels</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">            A dictionary of metrics containing the measured average &quot;loss&quot; and &quot;acc&quot;.</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">            If track_preds_targets is True, the dictionary contains also the keys</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">           &quot;preds&quot; and &quot;targets&quot;, each mapped to a list of integer labels</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">cum_loss</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="n">samples</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="n">x_all</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="n">y_all</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="c1"># x can be a list if the data loader</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="c1"># is associated to a multi-view dataset</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>            <span class="c1"># but in this context we are not using contrastive</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>            <span class="c1"># learning, hence we concat the views</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="c1"># if isinstance(x, list):</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>            <span class="c1">#    y = y.repeat(len(x))</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="c1">#    x = torch.cat(x, dim=0)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="c1"># scores = self.net.forward(x)</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="c1"># loss = self.criterion(scores, y)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="c1"># cum_loss += loss.item()</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="c1"># print(x.reshape(x.shape[0], -1).shape)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="c1"># x = x.cpu().numpy()</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="c1"># y = y.cpu().numpy()</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="n">x_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="c1"># y_all.append(y.reshape(y.shape[0], -1))</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">y_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="n">x_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="c1"># x_all = xgb.DMatrix(x_all)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="n">y_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">y_all</span><span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_all</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">y_all</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">samples</span> <span class="o">+=</span> <span class="n">x_all</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="n">preds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_all</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="c1"># loss=cum_loss / batch_idx,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="n">acc</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="o">*</span> <span class="n">correct</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="o">/</span> <span class="n">samples</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the internal model to train, calls _do_epoch() and return the obtained metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>    <span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        The entry point for triggering training</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">            train_loader: the data for training</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">            val_loader: the data for validation</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">            patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">            quiet: if False, no message on the console is reported</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">            The best model obtained during training</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>            <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>            <span class="n">context</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>        <span class="c1"># for idx_epoch in range(epochs):</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="n">train_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_one_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="c1"># msg = f&quot;epoch: {idx_epoch:3d} | &quot;</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="c1"># msg += &quot;train_loss: {loss:.6f}&quot;.format(loss=train_metrics[&quot;loss&quot;])</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="k">continue</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>            <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;train_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">if</span> <span class="n">val_loader</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="n">val_metrics</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="n">val_loader</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="c1"># msg += &quot; | val_loss: {loss:.6f}&quot;.format(loss=val_metrics[&quot;loss&quot;])</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>                <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>                <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;val_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span><span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>            <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">):</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>                <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span><span class="p">)</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>                <span class="k">pass</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="c1"># self.net.set_state_dict(self.best_model)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="k">def</span> <span class="nf">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="n">with_reports</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        Run inference on a model (for testing or validation)</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">            data_loader: the data to use</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">            with_reports: if True, compute classification report and confusion matrix</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">            A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">            during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">            and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">            was not requested</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>            <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="k">else</span> <span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">track_preds_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="n">preds</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="n">targets</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>        <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="k">if</span> <span class="n">with_reports</span><span class="p">:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="n">reports</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                <span class="n">class_rep</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                    <span class="n">classification_report</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>                <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                <span class="n">conf_mtx</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">)),</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>            <span class="p">)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">xgboost_model</span><span class="p">,</span> <span class="n">net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>xgboost_model</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>XGboost model</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>tracker</code></td>
          <td>
                <code>aim.<span title="aim.Run">Run</span></code>
          </td>
          <td><p>the AIM run on which register metrics</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>logger</code></td>
          <td>
                <code>logging.<span title="logging.Logger">Logger</span></code>
          </td>
          <td><p>the logging reference</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="n">xgboost_model</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="n">net</span><span class="p">:</span><span class="n">Any</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="n">device</span><span class="p">:</span><span class="n">Any</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="p">):</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a><span class="sd">        xgboost_model: XGboost model</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a><span class="sd">        tracker: the AIM run on which register metrics</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="sd">        logger: the logging reference</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span> <span class="o">=</span> <span class="n">xgboost_model</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer.log_msg" class="doc doc-heading">
<code class="highlight language-python"><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Register a message to file and echoes it
to the console</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="k">def</span> <span class="nf">log_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a message to file and echoes it</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    to the console&quot;&quot;&quot;</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>    <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer._reset_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_reset_metrics</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method to clean (before training)
internal objects used for tracking metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="k">def</span> <span class="nf">_reset_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to clean (before training)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    internal objects used for tracking metrics</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer._track_metrics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method invoked during training, validation
and testing to track loss and performance metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="k">def</span> <span class="nf">_track_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    and testing to track loss and performance metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">track</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">context</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer._do_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">track_preds_targets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method invoked during training, validation
and testing to perform forward (and backward) propagation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>an instance of a pytorch DataLoader</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>track_preds_targets</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, return predicted and target labels</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>A dictionary of metrics containing the measured average "loss" and "acc".</p></td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>If track_preds_targets is True, the dictionary contains also the keys</p></td>
        </tr>
    </tbody>
  </table>
      <p>"preds" and "targets", each mapped to a list of integer labels</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="k">def</span> <span class="nf">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="n">track_preds_targets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    and testing to perform forward (and backward) propagation</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">        data_loader: an instance of a pytorch DataLoader</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="sd">        track_preds_targets: if True, return predicted and target labels</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        A dictionary of metrics containing the measured average &quot;loss&quot; and &quot;acc&quot;.</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        If track_preds_targets is True, the dictionary contains also the keys</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">       &quot;preds&quot; and &quot;targets&quot;, each mapped to a list of integer labels</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="n">cum_loss</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="n">samples</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="n">x_all</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="n">y_all</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="c1"># x can be a list if the data loader</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="c1"># is associated to a multi-view dataset</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="c1"># but in this context we are not using contrastive</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="c1"># learning, hence we concat the views</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>        <span class="c1"># if isinstance(x, list):</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="c1">#    y = y.repeat(len(x))</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="c1">#    x = torch.cat(x, dim=0)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="c1"># scores = self.net.forward(x)</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="c1"># loss = self.criterion(scores, y)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="c1"># cum_loss += loss.item()</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="c1"># print(x.reshape(x.shape[0], -1).shape)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="c1"># x = x.cpu().numpy()</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="c1"># y = y.cpu().numpy()</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="n">x_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="c1"># y_all.append(y.reshape(y.shape[0], -1))</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">y_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="n">x_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="c1"># x_all = xgb.DMatrix(x_all)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>    <span class="n">y_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">y_all</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">y_all</span><span class="p">)</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_all</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>    <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">y_all</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>    <span class="n">samples</span> <span class="o">+=</span> <span class="n">x_all</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="n">preds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="n">targets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_all</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="c1"># loss=cum_loss / batch_idx,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">acc</span><span class="o">=</span><span class="mi">100</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="o">*</span> <span class="n">correct</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="o">/</span> <span class="n">samples</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="k">if</span> <span class="n">track_preds_targets</span><span class="p">:</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">targets</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer.train_one_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_one_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Set the internal model to train, calls _do_epoch() and return the obtained metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the internal model to train, calls _do_epoch() and return the obtained metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer.train_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_loop</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patience_monitor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The entry point for triggering training</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>train_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for training</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>val_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for validation</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>patience_monitor</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorLoss" href="#tcbench.modeling.methods.PatienceMonitorLoss">PatienceMonitorLoss</a> | <a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorAccuracy" href="#tcbench.modeling.methods.PatienceMonitorAccuracy">PatienceMonitorAccuracy</a></code>
          </td>
          <td><p>the instance of the patience monitor</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>quiet</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if False, no message on the console is reported</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>The best model obtained during training</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>    <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">    The entry point for triggering training</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        train_loader: the data for training</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">        val_loader: the data for validation</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">        patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">        quiet: if False, no message on the console is reported</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        The best model obtained during training</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="n">context</span> <span class="o">+=</span> <span class="s2">&quot;_&quot;</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="c1"># for idx_epoch in range(epochs):</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="n">train_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_one_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span><span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="c1"># msg = f&quot;epoch: {idx_epoch:3d} | &quot;</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="c1"># msg += &quot;train_loss: {loss:.6f}&quot;.format(loss=train_metrics[&quot;loss&quot;])</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">train_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="k">continue</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;train_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="k">if</span> <span class="n">val_loader</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="n">val_metrics</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="n">val_loader</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="c1"># msg += &quot; | val_loss: {loss:.6f}&quot;.format(loss=val_metrics[&quot;loss&quot;])</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">val_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="k">if</span> <span class="s2">&quot;acc&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_name</span><span class="p">:</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>                <span class="k">continue</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="n">metric_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;val_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric_value</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">%&quot;</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">val_metrics</span><span class="p">):</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">val&quot;</span><span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="k">if</span> <span class="n">patience_monitor</span> <span class="ow">and</span> <span class="n">patience_monitor</span><span class="p">(</span><span class="n">train_metrics</span><span class="p">):</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="n">patience_monitor</span><span class="o">.</span><span class="n">get_best_metrics</span><span class="p">()</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">train&quot;</span><span class="p">)</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; | *&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>            <span class="k">pass</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="c1"># self.net.set_state_dict(self.best_model)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xgboost_model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.XGboostTrainer.test_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Run inference on a model (for testing or validation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>with_reports</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, compute classification report and confusion matrix</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with two dictionaries. The first contains the metrics collected
during inference; the second contains classification report (class_rep)
and confusion matrix (conf_mtx) or is empty {} if their computation
was not requested</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="k">def</span> <span class="nf">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="n">with_reports</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">    Run inference on a model (for testing or validation)</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        data_loader: the data to use</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        with_reports: if True, compute classification report and confusion matrix</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">        A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">        during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        was not requested</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="k">else</span> <span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">track_preds_targets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="n">preds</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="n">targets</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="k">del</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>    <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="k">if</span> <span class="n">with_reports</span><span class="p">:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="n">reports</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>            <span class="n">class_rep</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                <span class="n">classification_report</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>            <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="n">conf_mtx</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">)),</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="n">preds</span><span class="o">=</span><span class="n">preds</span><span class="p">,</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="p">)</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.ContrastiveLearningTrainer" class="doc doc-heading">
        <code>ContrastiveLearningTrainer</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.SimpleTrainer" href="#tcbench.modeling.methods.SimpleTrainer">SimpleTrainer</a></code></p>

  
      <p>A trainer designed for contrastive learning</p>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="k">class</span> <span class="nc">ContrastiveLearningTrainer</span><span class="p">(</span><span class="n">SimpleTrainer</span><span class="p">):</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A trainer designed for contrastive learning&quot;&quot;&quot;</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">,</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">criterion</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="p">):</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>            <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>            <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>            <span class="n">tracker</span><span class="o">=</span><span class="n">tracker</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="p">)</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="k">def</span> <span class="nf">prepare_net_for_train</span><span class="p">(</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">        Clone a backbone.BaseNet a modifies to mask (via torch.nn.Identity)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">        its .classifier and the last activation function of .features</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">            net: the network to modify</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">            fname_weights: if provided, the weights are loaded into</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">                the network after the modification</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">            A new instance of the input network with architecture</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">            modification required to run training contrastive learning</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">            training</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="n">new_net</span> <span class="o">=</span> <span class="n">backbone</span><span class="o">.</span><span class="n">clone_net</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;prepare_for_contrastivelearning&quot;</span><span class="p">):</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                <span class="s2">&quot;Did not find a .prepare_for_contrativelearning() method in the network. Cannot adapt the network for training&quot;</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">new_net</span><span class="o">.</span><span class="n">prepare_for_contrastivelearning</span><span class="p">(</span><span class="n">fname_weights</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="n">new_net</span> <span class="o">=</span> <span class="n">new_net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="k">return</span> <span class="n">new_net</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>    <span class="k">def</span> <span class="nf">init_train</span><span class="p">(</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">]:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">        Clones the input network and prepares it for contrastive learning,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        and instanciate a new optimized bounding it to the new network weights</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">            net: the network to use</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">            optimizer: the optimizer to tuse</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">            fname_weights: if provided, the weights are loaded</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">                into the new network before returning it</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">            A tuple with the new updated network and the related optimizer</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="n">new_net</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">prepare_net_for_train</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">fname_weights</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>        <span class="n">new_optimizer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>        <span class="k">if</span> <span class="n">optimizer</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="n">new_optimizer</span> <span class="o">=</span> <span class="n">_reset_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">new_net</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="k">return</span> <span class="n">new_net</span><span class="p">,</span> <span class="n">new_optimizer</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>    <span class="k">def</span> <span class="nf">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        and testing to perform forward (and backward) propagation</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">            data_loader: an instance of a pytorch DataLoader</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">            idx_epoch: the current epoch</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">            A dictionary of metrics collected</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="n">cum_metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="c1"># x is a list with the multiple views</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>            <span class="n">bsz</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="c1"># forward pass</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="c1"># apply L2 normalization</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="c1"># compute loss</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="p">[</span><span class="n">bsz</span><span class="p">,</span> <span class="n">bsz</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>            <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">f1</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">f2</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="n">cum_metrics</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">batch_idx</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cum_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;acc&quot;</span><span class="p">):</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>                <span class="n">value</span> <span class="o">*=</span> <span class="mi">100</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="n">metrics</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>    <span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the internal model to train, calls _do_epoch() and return the obtained metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="k">return</span> <span class="n">out</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoaer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="n">run_init_train</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">        The entry point for triggering training</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">            epochs: number of epochs to run</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">            train_loader: the data for training</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">            val_loader: the data for validation</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">            patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">            quiet: if False, no message on the console is reported</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">            The best model obtained during training</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="k">assert</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="k">if</span> <span class="n">run_init_train</span><span class="p">:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_train</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">)</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">======= net adapted for contrastive learning training =========&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="n">torchsummary</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>            <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span class="n">patience_monitor</span><span class="o">=</span><span class="n">patience_monitor</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>            <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="p">)</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="k">def</span> <span class="nf">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>        <span class="n">idx_epoch</span><span class="p">:</span> <span class="n">ind</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">        Run inference on a model (for testing or validation)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">            data_loader: the data to use</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">            idx_epoch: the current epoch</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">            A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">            during inference; the second is an empty dictionary</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="k">else</span> <span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>        <span class="c1"># we return an empty report just to have</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="c1"># consistency with the return types</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="c1"># of SimpleTrainer</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.ContrastiveLearningTrainer.prepare_net_for_train" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_net_for_train</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">fname_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Clone a backbone.BaseNet a modifies to mask (via torch.nn.Identity)
its .classifier and the last activation function of .features</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to modify</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fname_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>if provided, the weights are loaded into
the network after the modification</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A new instance of the input network with architecture
modification required to run training contrastive learning
training</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="k">def</span> <span class="nf">prepare_net_for_train</span><span class="p">(</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="bp">cls</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">    Clone a backbone.BaseNet a modifies to mask (via torch.nn.Identity)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">    its .classifier and the last activation function of .features</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">        net: the network to modify</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        fname_weights: if provided, the weights are loaded into</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">            the network after the modification</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        A new instance of the input network with architecture</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">        modification required to run training contrastive learning</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">        training</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>    <span class="n">new_net</span> <span class="o">=</span> <span class="n">backbone</span><span class="o">.</span><span class="n">clone_net</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;prepare_for_contrastivelearning&quot;</span><span class="p">):</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="s2">&quot;Did not find a .prepare_for_contrativelearning() method in the network. Cannot adapt the network for training&quot;</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="n">new_net</span><span class="o">.</span><span class="n">prepare_for_contrastivelearning</span><span class="p">(</span><span class="n">fname_weights</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="n">new_net</span> <span class="o">=</span> <span class="n">new_net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="k">return</span> <span class="n">new_net</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.ContrastiveLearningTrainer.init_train" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_train</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Clones the input network and prepares it for contrastive learning,
and instanciate a new optimized bounding it to the new network weights</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>optimizer</code></td>
          <td>
                <code>torch.<span title="torch.optim">optim</span>.<span title="torch.optim.Optimizer">Optimizer</span></code>
          </td>
          <td><p>the optimizer to tuse</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fname_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>if provided, the weights are loaded
into the new network before returning it</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with the new updated network and the related optimizer</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="k">def</span> <span class="nf">init_train</span><span class="p">(</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">]:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">    Clones the input network and prepares it for contrastive learning,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    and instanciate a new optimized bounding it to the new network weights</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">        net: the network to use</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">        optimizer: the optimizer to tuse</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">        fname_weights: if provided, the weights are loaded</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">            into the new network before returning it</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">        A tuple with the new updated network and the related optimizer</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="n">new_net</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">prepare_net_for_train</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">fname_weights</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="n">new_optimizer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>    <span class="k">if</span> <span class="n">optimizer</span><span class="p">:</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="n">new_optimizer</span> <span class="o">=</span> <span class="n">_reset_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">new_net</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>    <span class="k">return</span> <span class="n">new_net</span><span class="p">,</span> <span class="n">new_optimizer</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.ContrastiveLearningTrainer._do_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Helper method invoked during training, validation
and testing to perform forward (and backward) propagation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>an instance of a pytorch DataLoader</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx_epoch</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the current epoch</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>&#39;train&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A dictionary of metrics collected</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="k">def</span> <span class="nf">_do_epoch</span><span class="p">(</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>    <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method invoked during training, validation</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">    and testing to perform forward (and backward) propagation</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        data_loader: an instance of a pytorch DataLoader</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        idx_epoch: the current epoch</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">        A dictionary of metrics collected</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="n">cum_metrics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>    <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_loader</span><span class="p">):</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="c1"># x is a list with the multiple views</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">bsz</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="c1"># forward pass</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="c1"># apply L2 normalization</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="c1"># compute loss</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>        <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="p">[</span><span class="n">bsz</span><span class="p">,</span> <span class="n">bsz</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">f1</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">f2</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criterion</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span><span class="p">:</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>            <span class="n">cum_metrics</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">batch_idx</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cum_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;acc&quot;</span><span class="p">):</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="n">value</span> <span class="o">*=</span> <span class="mi">100</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="n">metrics</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_track_metrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>    <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.ContrastiveLearningTrainer.train_one_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_one_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Set the internal model to train, calls _do_epoch() and return the obtained metrics</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the internal model to train, calls _do_epoch() and return the obtained metrics&quot;&quot;&quot;</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.ContrastiveLearningTrainer.train_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">train_loop</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patience_monitor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">run_init_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The entry point for triggering training</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>epochs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of epochs to run</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>train_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for training</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>val_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoaer">DataLoaer</span></code>
          </td>
          <td><p>the data for validation</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>patience_monitor</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorLoss" href="#tcbench.modeling.methods.PatienceMonitorLoss">PatienceMonitorLoss</a> | <a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorAccuracy" href="#tcbench.modeling.methods.PatienceMonitorAccuracy">PatienceMonitorAccuracy</a></code>
          </td>
          <td><p>the instance of the patience monitor</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>quiet</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if False, no message on the console is reported</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>The best model obtained during training</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="k">def</span> <span class="nf">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>    <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoaer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>    <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>    <span class="n">quiet</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>    <span class="n">run_init_train</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    The entry point for triggering training</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        epochs: number of epochs to run</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">        train_loader: the data for training</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        val_loader: the data for validation</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">        patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">        quiet: if False, no message on the console is reported</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">        The best model obtained during training</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>    <span class="k">assert</span> <span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>    <span class="k">if</span> <span class="n">run_init_train</span><span class="p">:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_train</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">)</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">======= net adapted for contrastive learning training =========&quot;</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="p">)</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span class="n">torchsummary</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>        <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="n">patience_monitor</span><span class="o">=</span><span class="n">patience_monitor</span><span class="p">,</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.ContrastiveLearningTrainer.test_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Run inference on a model (for testing or validation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx_epoch</code></td>
          <td>
                <code>ind</code>
          </td>
          <td><p>the current epoch</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with two dictionaries. The first contains the metrics collected
during inference; the second is an empty dictionary</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="k">def</span> <span class="nf">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>    <span class="n">idx_epoch</span><span class="p">:</span> <span class="n">ind</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    Run inference on a model (for testing or validation)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        data_loader: the data to use</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        idx_epoch: the current epoch</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">        A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">        during inference; the second is an empty dictionary</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="n">context</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_training</span> <span class="k">else</span> <span class="s2">&quot;test&quot;</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_epoch</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="c1"># we return an empty report just to have</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>    <span class="c1"># consistency with the return types</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="c1"># of SimpleTrainer</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="n">reports</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="k">return</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.MonolithicTrainer" class="doc doc-heading">
        <code>MonolithicTrainer</code>


</h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.SimpleTrainer" href="#tcbench.modeling.methods.SimpleTrainer">SimpleTrainer</a></code></p>

  
      <p>A wrapper around SimpleTrainer and designed
to be used in supervised classification scenarios</p>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="k">class</span> <span class="nc">MonolithicTrainer</span><span class="p">(</span><span class="n">SimpleTrainer</span><span class="p">):</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper around SimpleTrainer and designed</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">    to be used in supervised classification scenarios</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>        <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>        <span class="n">criterion</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(),</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="n">reset_classifier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>        <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="n">xgboost_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="p">):</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">            net: the architecture to use</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">            optimizer: the optimizer to use</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">            criterion: the instance of the loss to use</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">            device: the device to use</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">            deterministic: see _make_deterministic()</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">            tracker: the AIM run on which register metrics</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">            logger: the logging reference</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">            reset_classifier: if True, the network is modified</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">                to have a new layer</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">            num_classes: number of units to use for the new</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">                classifier head</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="k">if</span> <span class="n">reset_classifier</span><span class="p">:</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="k">if</span> <span class="n">num_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                    <span class="sa">f</span><span class="s2">&quot;num_classes cannot be None when resetting the model head&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                <span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>            <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">reset_classifier</span><span class="p">(</span><span class="n">num_classes</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>            <span class="n">tracker</span><span class="o">=</span><span class="n">tracker</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.MonolithicTrainer.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset_classifier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xgboost_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the architecture to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>optimizer</code></td>
          <td>
                <code>torch.<span title="torch.optim">optim</span>.<span title="torch.optim.Optimizer">Optimizer</span></code>
          </td>
          <td><p>the optimizer to use</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>criterion</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>the instance of the loss to use</p></td>
          <td>
                <code>nn.CrossEntropyLoss()</code>
          </td>
        </tr>
        <tr>
          <td><code>device</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the device to use</p></td>
          <td>
                <code>&#39;cuda:0&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>deterministic</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>see _make_deterministic()</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>tracker</code></td>
          <td>
                <code>aim.<span title="aim.Run">Run</span></code>
          </td>
          <td><p>the AIM run on which register metrics</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>logger</code></td>
          <td>
                <code>logging.<span title="logging.Logger">Logger</span></code>
          </td>
          <td><p>the logging reference</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reset_classifier</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, the network is modified
to have a new layer</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>num_classes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of units to use for the new
classifier head</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>    <span class="n">criterion</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(),</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="n">reset_classifier</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="n">xgboost_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="p">):</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        net: the architecture to use</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">        optimizer: the optimizer to use</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">        criterion: the instance of the loss to use</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        device: the device to use</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">        deterministic: see _make_deterministic()</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">        tracker: the AIM run on which register metrics</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        logger: the logging reference</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a><span class="sd">        reset_classifier: if True, the network is modified</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">            to have a new layer</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">        num_classes: number of units to use for the new</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">            classifier head</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="k">if</span> <span class="n">reset_classifier</span><span class="p">:</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="k">if</span> <span class="n">num_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>                <span class="sa">f</span><span class="s2">&quot;num_classes cannot be None when resetting the model head&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>            <span class="p">)</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">reset_classifier</span><span class="p">(</span><span class="n">num_classes</span><span class="p">)</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">,</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="n">tracker</span><span class="o">=</span><span class="n">tracker</span><span class="p">,</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tcbench.modeling.methods.SimCLRTrainer" class="doc doc-heading">
        <code>SimCLRTrainer</code>


</h3>


  <div class="doc doc-contents ">

  
      <p>A trainer designed for SimCLR (https://arxiv.org/abs/2002.05709).
Differently from the other trainers which are based on
inheritancs, it is based on nesting a ContrastiveLearningTrainer
object (for contrastive learning) and a MonolithicTrainer object (for finetune)</p>


        <details class="quote">
          <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="k">class</span> <span class="nc">SimCLRTrainer</span><span class="p">:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A trainer designed for SimCLR (https://arxiv.org/abs/2002.05709).</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">    Differently from the other trainers which are based on</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a><span class="sd">    inheritancs, it is based on nesting a ContrastiveLearningTrainer</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a><span class="sd">    object (for contrastive learning) and a MonolithicTrainer object (for finetune)</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="n">pretrain_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="n">finetune_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>        <span class="n">xgboost_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="p">):</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">            pretrain_config: a set of configuration required for pretraining.</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">                The dictionary should contain an &quot;optimizer&quot; and the related instance</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">                (None if missing) and a &quot;loss_temperature&quot; (0.07 if missing)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">            finetune_config: a set of configuration required for finetune.</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">                The dictionary should contain an &quot;optimizer&quot; and the related instance</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">                (None if missing).</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">            device: the device for training and inference</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">            tracker: the AIM run for metric tracking</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">            logger: a logging object for console and file logging</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_config</span> <span class="o">=</span> <span class="n">pretrain_config</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_criterion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_best_net</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_config</span> <span class="o">=</span> <span class="n">finetune_config</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_criterion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_best_net</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="n">trainer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>            <span class="n">net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="n">tracker</span><span class="o">=</span><span class="n">tracker</span><span class="p">,</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>        <span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="k">if</span> <span class="n">pretrain_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_criterion</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">SimCLRLoss</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                <span class="n">temperature</span><span class="o">=</span><span class="n">pretrain_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loss_temperature&quot;</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                <span class="n">base_temperature</span><span class="o">=</span><span class="n">pretrain_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loss_base_temperature&quot;</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                <span class="n">contrast_mode</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>            <span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span> <span class="o">=</span> <span class="n">ContrastiveLearningTrainer</span><span class="p">(</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">pretrain_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimizer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>                <span class="n">criterion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pretrain_criterion</span><span class="p">,</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>                <span class="o">**</span><span class="n">trainer_params</span><span class="p">,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="p">)</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="k">if</span> <span class="n">finetune_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">finetune_criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span> <span class="o">=</span> <span class="n">MonolithicTrainer</span><span class="p">(</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="n">finetune_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimizer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>                <span class="n">criterion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finetune_criterion</span><span class="p">,</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>                <span class="o">**</span><span class="n">trainer_params</span><span class="p">,</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>            <span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="n">_make_deterministic</span><span class="p">()</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>    <span class="k">def</span> <span class="nf">init_pretrain</span><span class="p">(</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>        <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>        <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">        Clones the input network and prepares it for contrastive learning,</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">        and instanciate a new optimized bounding it to the new network weights</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">            net: the network to use</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">            optimizer: the optimizer to tuse</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">            fname_weights: if provided, the weights are loaded</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">                into the new network before returning it</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">            A tuple with the new updated network and the related optimizer</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="k">return</span> <span class="n">ContrastiveLearningTrainer</span><span class="o">.</span><span class="n">init_train</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">fname_weights</span><span class="p">)</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>    <span class="k">def</span> <span class="nf">pretrain_loop</span><span class="p">(</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>        <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="n">run_init_pretrain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">        The entry point for triggering training</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">            net: the network to use</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">            train_loader: the data for training</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">            val_loader: the data for validation</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">            patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">            epochs: number of epochs to run</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">            run_init_pretrain: if True, invokes .init_pretrain()</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">            fname_weights: a file with the weights to load after</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">                preparing the model for training</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><span class="sd">            The best model obtained during training</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="k">if</span> <span class="n">run_init_pretrain</span><span class="p">:</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            <span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_pretrain</span><span class="p">(</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>                <span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">fname_weights</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="n">expected_dtype</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>            <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">==== network adapted for pretrain ====&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>            <span class="n">torchsummary</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>            <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>            <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>            <span class="n">patience_monitor</span><span class="o">=</span><span class="n">patience_monitor</span><span class="p">,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>            <span class="n">run_init_train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>        <span class="p">)</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_best_model</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>    <span class="k">def</span> <span class="nf">prepare_net_for_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>        <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="n">fname_pretrain_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="n">fname_finetune_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="sd">        Clone a backbone.BaseNet related to contrastive learning an</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="sd">        prepare it for finetune. Specifically, the last linear layer</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">        of the newtwork (the projection layer) is masked (via a nn.Identity)</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">        and a classifier is added to the network</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">            net: the network to modify</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">            num_classes: the number of units for the classifier</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">            A new instance of the input network with architecture</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">            modification required to run training contrastive learning</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">            training</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;prepare_for_finetune&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                <span class="s2">&quot;Did not find a .prepare_for_finetune() method in the network. Cannot adapt the network for training&quot;</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>        <span class="n">new_net</span> <span class="o">=</span> <span class="n">backbone</span><span class="o">.</span><span class="n">clone_net</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>        <span class="n">new_net</span><span class="o">.</span><span class="n">prepare_for_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="n">fname_pretrain_weights</span><span class="p">,</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>            <span class="n">fname_finetune_weights</span><span class="o">=</span><span class="n">fname_finetune_weights</span><span class="p">,</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>        <span class="p">)</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>        <span class="k">return</span> <span class="n">new_net</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>    <span class="k">def</span> <span class="nf">init_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>        <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>        <span class="n">fname_pretrain_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>        <span class="n">fname_finetune_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>        <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">]:</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">        Initialize the network for finetuning adapting</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">        it from contrastive-learning. Specifically, the</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">        input network is the first modified for contrastive-learning,</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">        and then further adjusted for finetune.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><span class="sd">            net: the network to use</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="sd">            num_classes: the number of classes for the classifier</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><span class="sd">            fname_pretrain_weights: if specified, the weights</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><span class="sd">                are loaded before adapting the network from</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="sd">                pretraining</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="sd">            fname_finetune_weights: if specified, the weights</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><span class="sd">                are loaded after adapting the network for</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><span class="sd">                finetune</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="n">new_net</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">prepare_net_for_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="n">net</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">fname_pretrain_weights</span><span class="p">,</span> <span class="n">fname_finetune_weights</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>        <span class="p">)</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>        <span class="n">new_optimizer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="k">if</span> <span class="n">optimizer</span><span class="p">:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>            <span class="n">new_optimizer</span> <span class="o">=</span> <span class="n">_reset_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">new_net</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="k">return</span> <span class="n">new_net</span><span class="p">,</span> <span class="n">new_optimizer</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>    <span class="k">def</span> <span class="nf">finetune_loop</span><span class="p">(</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>        <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>        <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>        <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>        <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="n">run_init_finetune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="n">fname_pretrain_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">PAth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="sd">        The entry point for triggering training</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">            net: the network to use</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">            train_loader: the data for training</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="sd">            val_loader: the data for validation</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a><span class="sd">            patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">            epochs: number of epochs to run</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="sd">            num_classes: the number of units for the classifier</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">            run_init_finetune: if True, invokes .init_finetune()</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">            fname_pretrain_weights: a file with the weights to load after</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><span class="sd">                preparing the model for training</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">            The best model obtained during training</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="k">if</span> <span class="n">run_init_finetune</span><span class="p">:</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>            <span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>                <span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>                <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>                <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="n">fname_pretrain_weights</span><span class="p">,</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>                <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>            <span class="p">)</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>            <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">finetune_net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>            <span class="c1"># x can be a list if the underlining</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>            <span class="c1"># dataset is multi-view</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>            <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">==== network adapted for fine-tuning ====&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>            <span class="n">torchsummary</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>            <span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_best_net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>            <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>            <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>            <span class="n">patience_monitor</span><span class="o">=</span><span class="n">patience_monitor</span><span class="p">,</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>        <span class="p">)</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune_best_net</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>    <span class="k">def</span> <span class="nf">finetune_test_loop</span><span class="p">(</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="n">with_reports</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">        Run inference on a (supervised) model (for testing or validation)</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">            data_loader: the data to use</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="sd">            idx_epoch: the current epoch</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">            with_reports: if True, compute classification report and confusion matrix</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">            A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="sd">            during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="sd">            and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">            was not requested</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">with_reports</span><span class="p">,</span> <span class="n">context</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>        <span class="p">)</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>    <span class="k">def</span> <span class="nf">pretrain_test_loop</span><span class="p">(</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>        <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>        <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a><span class="sd">        Run inference on a (unsupervised) model (for testing or validation)</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">            data_loader: the data to use</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">            idx_epoch: the current epoch</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">            context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">        Return:</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a><span class="sd">            A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">            during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a><span class="sd">            and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">            was not requested</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pretrain_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">finetune_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xgboost_model</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pretrain_config</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>a set of configuration required for pretraining.
The dictionary should contain an "optimizer" and the related instance
(None if missing) and a "loss_temperature" (0.07 if missing)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>finetune_config</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
          </td>
          <td><p>a set of configuration required for finetune.
The dictionary should contain an "optimizer" and the related instance
(None if missing).</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>device</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the device for training and inference</p></td>
          <td>
                <code>&#39;cuda:0&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>tracker</code></td>
          <td>
                <code>aim.<span title="aim.Run">Run</span></code>
          </td>
          <td><p>the AIM run for metric tracking</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>logger</code></td>
          <td>
                <code>logging.<span title="logging.Logger">Logger</span></code>
          </td>
          <td><p>a logging object for console and file logging</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="n">pretrain_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="n">finetune_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>    <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="n">tracker</span><span class="p">:</span> <span class="n">aim</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>    <span class="n">xgboost_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="p">):</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        pretrain_config: a set of configuration required for pretraining.</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">            The dictionary should contain an &quot;optimizer&quot; and the related instance</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">            (None if missing) and a &quot;loss_temperature&quot; (0.07 if missing)</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">        finetune_config: a set of configuration required for finetune.</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">            The dictionary should contain an &quot;optimizer&quot; and the related instance</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">            (None if missing).</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">        device: the device for training and inference</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">        tracker: the AIM run for metric tracking</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        logger: a logging object for console and file logging</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tracker</span> <span class="o">=</span> <span class="n">tracker</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_config</span> <span class="o">=</span> <span class="n">pretrain_config</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_criterion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_best_net</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">finetune_config</span> <span class="o">=</span> <span class="n">finetune_config</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">finetune_criterion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">finetune_best_net</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="n">trainer_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="n">net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="n">tracker</span><span class="o">=</span><span class="n">tracker</span><span class="p">,</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>        <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>    <span class="p">)</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>    <span class="k">if</span> <span class="n">pretrain_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_criterion</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">SimCLRLoss</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>            <span class="n">temperature</span><span class="o">=</span><span class="n">pretrain_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loss_temperature&quot;</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="n">base_temperature</span><span class="o">=</span><span class="n">pretrain_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loss_base_temperature&quot;</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">),</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>            <span class="n">contrast_mode</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="p">)</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span> <span class="o">=</span> <span class="n">ContrastiveLearningTrainer</span><span class="p">(</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">pretrain_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimizer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="n">criterion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pretrain_criterion</span><span class="p">,</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="o">**</span><span class="n">trainer_params</span><span class="p">,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="p">)</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="k">if</span> <span class="n">finetune_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span> <span class="o">=</span> <span class="n">MonolithicTrainer</span><span class="p">(</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">finetune_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optimizer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>            <span class="n">criterion</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finetune_criterion</span><span class="p">,</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>            <span class="o">**</span><span class="n">trainer_params</span><span class="p">,</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="n">_make_deterministic</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.init_pretrain" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_pretrain</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Clones the input network and prepares it for contrastive learning,
and instanciate a new optimized bounding it to the new network weights</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>optimizer</code></td>
          <td>
                <code>torch.<span title="torch.optim">optim</span>.<span title="torch.optim.Optimizer">Optimizer</span></code>
          </td>
          <td><p>the optimizer to tuse</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fname_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>if provided, the weights are loaded
into the new network before returning it</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with the new updated network and the related optimizer</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="k">def</span> <span class="nf">init_pretrain</span><span class="p">(</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">    Clones the input network and prepares it for contrastive learning,</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    and instanciate a new optimized bounding it to the new network weights</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        net: the network to use</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">        optimizer: the optimizer to tuse</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a><span class="sd">        fname_weights: if provided, the weights are loaded</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">            into the new network before returning it</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">        A tuple with the new updated network and the related optimizer</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>    <span class="k">return</span> <span class="n">ContrastiveLearningTrainer</span><span class="o">.</span><span class="n">init_train</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">fname_weights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.pretrain_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pretrain_loop</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patience_monitor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">run_init_pretrain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fname_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The entry point for triggering training</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>train_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for training</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>val_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.Data">Data</span>.<span title="torch.utils.Data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for validation</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>patience_monitor</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorLoss" href="#tcbench.modeling.methods.PatienceMonitorLoss">PatienceMonitorLoss</a> | <a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorAccuracy" href="#tcbench.modeling.methods.PatienceMonitorAccuracy">PatienceMonitorAccuracy</a></code>
          </td>
          <td><p>the instance of the patience monitor</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>epochs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of epochs to run</p></td>
          <td>
                <code>50</code>
          </td>
        </tr>
        <tr>
          <td><code>run_init_pretrain</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, invokes .init_pretrain()</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>fname_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>a file with the weights to load after
preparing the model for training</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>The best model obtained during training</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="k">def</span> <span class="nf">pretrain_loop</span><span class="p">(</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>    <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>    <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>    <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>    <span class="n">run_init_pretrain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>    <span class="n">fname_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="sd">    The entry point for triggering training</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        net: the network to use</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">        train_loader: the data for training</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">        val_loader: the data for validation</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">        patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">        epochs: number of epochs to run</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">        run_init_pretrain: if True, invokes .init_pretrain()</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">        fname_weights: a file with the weights to load after</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">            preparing the model for training</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a><span class="sd">        The best model obtained during training</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>    <span class="k">if</span> <span class="n">run_init_pretrain</span><span class="p">:</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>        <span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_pretrain</span><span class="p">(</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>            <span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">fname_weights</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="p">)</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>        <span class="n">expected_dtype</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">==== network adapted for pretrain ====&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>        <span class="n">torchsummary</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_best_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>        <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>        <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>        <span class="n">patience_monitor</span><span class="o">=</span><span class="n">patience_monitor</span><span class="p">,</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>        <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>        <span class="n">run_init_train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>    <span class="p">)</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_best_model</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.prepare_net_for_finetune" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_net_for_finetune</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname_finetune_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Clone a backbone.BaseNet related to contrastive learning an
prepare it for finetune. Specifically, the last linear layer
of the newtwork (the projection layer) is masked (via a nn.Identity)
and a classifier is added to the network</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to modify</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_classes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the number of units for the classifier</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A new instance of the input network with architecture
modification required to run training contrastive learning
training</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="k">def</span> <span class="nf">prepare_net_for_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="n">fname_pretrain_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="n">fname_finetune_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="sd">    Clone a backbone.BaseNet related to contrastive learning an</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="sd">    prepare it for finetune. Specifically, the last linear layer</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">    of the newtwork (the projection layer) is masked (via a nn.Identity)</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">    and a classifier is added to the network</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        net: the network to modify</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">        num_classes: the number of units for the classifier</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">        A new instance of the input network with architecture</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a><span class="sd">        modification required to run training contrastive learning</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a><span class="sd">        training</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;prepare_for_finetune&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>            <span class="s2">&quot;Did not find a .prepare_for_finetune() method in the network. Cannot adapt the network for training&quot;</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>    <span class="n">new_net</span> <span class="o">=</span> <span class="n">backbone</span><span class="o">.</span><span class="n">clone_net</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>    <span class="n">new_net</span><span class="o">.</span><span class="n">prepare_for_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="n">fname_pretrain_weights</span><span class="p">,</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="n">fname_finetune_weights</span><span class="o">=</span><span class="n">fname_finetune_weights</span><span class="p">,</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>    <span class="p">)</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>    <span class="k">return</span> <span class="n">new_net</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.init_finetune" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_finetune</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname_finetune_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initialize the network for finetuning adapting
it from contrastive-learning. Specifically, the
input network is the first modified for contrastive-learning,
and then further adjusted for finetune.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_classes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the number of classes for the classifier</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fname_pretrain_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>if specified, the weights
are loaded before adapting the network from
pretraining</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fname_finetune_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td><p>if specified, the weights
are loaded after adapting the network for
finetune</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="k">def</span> <span class="nf">init_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>    <span class="bp">cls</span><span class="p">,</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>    <span class="n">fname_pretrain_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>    <span class="n">fname_finetune_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>    <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">]:</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">    Initialize the network for finetuning adapting</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">    it from contrastive-learning. Specifically, the</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">    input network is the first modified for contrastive-learning,</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">    and then further adjusted for finetune.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a><span class="sd">        net: the network to use</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a><span class="sd">        num_classes: the number of classes for the classifier</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a><span class="sd">        fname_pretrain_weights: if specified, the weights</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a><span class="sd">            are loaded before adapting the network from</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a><span class="sd">            pretraining</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="sd">        fname_finetune_weights: if specified, the weights</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a><span class="sd">            are loaded after adapting the network for</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a><span class="sd">            finetune</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>    <span class="n">new_net</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">prepare_net_for_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>        <span class="n">net</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">fname_pretrain_weights</span><span class="p">,</span> <span class="n">fname_finetune_weights</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="p">)</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="n">new_optimizer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>    <span class="k">if</span> <span class="n">optimizer</span><span class="p">:</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="n">new_optimizer</span> <span class="o">=</span> <span class="n">_reset_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">new_net</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>    <span class="k">return</span> <span class="n">new_net</span><span class="p">,</span> <span class="n">new_optimizer</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.finetune_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">finetune_loop</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">val_loader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patience_monitor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">run_init_finetune</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>The entry point for triggering training</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>net</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.backbone" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone">backbone</a>.<a class="autorefs autorefs-internal" title="tcbench.modeling.backbone.BaseNet" href="../tcbench_modeling_backbone/#tcbench.modeling.backbone.BaseNet">BaseNet</a></code>
          </td>
          <td><p>the network to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>train_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for training</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>val_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data for validation</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>patience_monitor</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorLoss" href="#tcbench.modeling.methods.PatienceMonitorLoss">PatienceMonitorLoss</a> | <a class="autorefs autorefs-internal" title="tcbench.modeling.methods.PatienceMonitorAccuracy" href="#tcbench.modeling.methods.PatienceMonitorAccuracy">PatienceMonitorAccuracy</a></code>
          </td>
          <td><p>the instance of the patience monitor</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>epochs</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>number of epochs to run</p></td>
          <td>
                <code>50</code>
          </td>
        </tr>
        <tr>
          <td><code>num_classes</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the number of units for the classifier</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>run_init_finetune</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, invokes .init_finetune()</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>fname_pretrain_weights</code></td>
          <td>
                <code>pathlib.<span title="pathlib.PAth">PAth</span></code>
          </td>
          <td><p>a file with the weights to load after
preparing the model for training</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>The best model obtained during training</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1186" name="__codelineno-0-1186"></a><span class="k">def</span> <span class="nf">finetune_loop</span><span class="p">(</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="n">net</span><span class="p">:</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">,</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>    <span class="n">train_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>    <span class="n">val_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>    <span class="n">patience_monitor</span><span class="p">:</span> <span class="n">PatienceMonitorLoss</span> <span class="o">|</span> <span class="n">PatienceMonitorAccuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>    <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>    <span class="n">run_init_finetune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>    <span class="n">fname_pretrain_weights</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">PAth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">backbone</span><span class="o">.</span><span class="n">BaseNet</span><span class="p">:</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="sd">    The entry point for triggering training</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">        net: the network to use</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">        train_loader: the data for training</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="sd">        val_loader: the data for validation</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a><span class="sd">        patience_monitor: the instance of the patience monitor</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">        epochs: number of epochs to run</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="sd">        num_classes: the number of units for the classifier</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">        run_init_finetune: if True, invokes .init_finetune()</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">        fname_pretrain_weights: a file with the weights to load after</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><span class="sd">            preparing the model for training</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">        The best model obtained during training</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>    <span class="k">if</span> <span class="n">run_init_finetune</span><span class="p">:</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="n">net</span><span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_finetune</span><span class="p">(</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>            <span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">,</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>            <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>            <span class="n">fname_pretrain_weights</span><span class="o">=</span><span class="n">fname_pretrain_weights</span><span class="p">,</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="p">)</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">finetune_net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>        <span class="c1"># x can be a list if the underlining</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>        <span class="c1"># dataset is multi-view</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>        <span class="n">utils</span><span class="o">.</span><span class="n">log_msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">==== network adapted for fine-tuning ====&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>        <span class="n">torchsummary</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>        <span class="n">net</span><span class="o">.</span><span class="n">double</span><span class="p">()</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">net</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">finetune_best_net</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">train_loop</span><span class="p">(</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>        <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>        <span class="n">val_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">,</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>        <span class="n">patience_monitor</span><span class="o">=</span><span class="n">patience_monitor</span><span class="p">,</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>        <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>    <span class="p">)</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune_best_net</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.finetune_test_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">finetune_test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_reports</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Run inference on a (supervised) model (for testing or validation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx_epoch</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the current epoch</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>with_reports</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True, compute classification report and confusion matrix</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with two dictionaries. The first contains the metrics collected
during inference; the second contains classification report (class_rep)
and confusion matrix (conf_mtx) or is empty {} if their computation
was not requested</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1247" name="__codelineno-0-1247"></a><span class="k">def</span> <span class="nf">finetune_test_loop</span><span class="p">(</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>    <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>    <span class="n">with_reports</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">    Run inference on a (supervised) model (for testing or validation)</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">        data_loader: the data to use</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="sd">        idx_epoch: the current epoch</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">        with_reports: if True, compute classification report and confusion matrix</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a><span class="sd">        A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a><span class="sd">        during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a><span class="sd">        and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a><span class="sd">        was not requested</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune_trainer</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">with_reports</span><span class="p">,</span> <span class="n">context</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tcbench.modeling.methods.SimCLRTrainer.pretrain_test_loop" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pretrain_test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Run inference on a (unsupervised) model (for testing or validation)</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>data_loader</code></td>
          <td>
                <code>torch.<span title="torch.utils">utils</span>.<span title="torch.utils.data">data</span>.<span title="torch.utils.data.DataLoader">DataLoader</span></code>
          </td>
          <td><p>the data to use</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>idx_epoch</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the current epoch</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>context</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>a string (for tracking) for extra semantic (train, val, etc.)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>A tuple with two dictionaries. The first contains the metrics collected
during inference; the second contains classification report (class_rep)
and confusion matrix (conf_mtx) or is empty {} if their computation
was not requested</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1273" name="__codelineno-0-1273"></a><span class="k">def</span> <span class="nf">pretrain_test_loop</span><span class="p">(</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>    <span class="n">data_loader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">,</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>    <span class="n">idx_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]]:</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a><span class="sd">    Run inference on a (unsupervised) model (for testing or validation)</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a><span class="sd">        data_loader: the data to use</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a><span class="sd">        idx_epoch: the current epoch</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a><span class="sd">        context: a string (for tracking) for extra semantic (train, val, etc.)</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a><span class="sd">        A tuple with two dictionaries. The first contains the metrics collected</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a><span class="sd">        during inference; the second contains classification report (class_rep)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a><span class="sd">        and confusion matrix (conf_mtx) or is empty {} if their computation</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a><span class="sd">        was not requested</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretrain_trainer</span><span class="o">.</span><span class="n">test_loop</span><span class="p">(</span><span class="n">data_loader</span><span class="p">,</span> <span class="n">idx_epoch</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="tcbench.modeling.methods._make_deterministic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_make_deterministic</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Helper method to force pytorch to be deterministic</p>

      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="k">def</span> <span class="nf">_make_deterministic</span><span class="p">():</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to force pytorch to be deterministic&quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">use_deterministic_algorithms</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUBLAS_WORKSPACE_CONFIG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;:4096:8&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tcbench.modeling.methods._reset_optimizer" class="doc doc-heading">
<code class="highlight language-python"><span class="n">_reset_optimizer</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">net_parameters</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Helper method to recreate a new instance of
the optimizer passed as input (via introspection)
with the same configuration and bound to the
network parameters of a model</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>optimizer</code></td>
          <td>
                <code>torch.<span title="torch.optim">optim</span>.<span title="torch.optim.Optimizer">Optimizer</span></code>
          </td>
          <td><p>the optimizer to clone</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>net_parameters</code></td>
          <td>
                <code><span title="typing.Generator">Generator</span></code>
          </td>
          <td><p>iterator obtained calling .parameters() from a pytorch module</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>a new instance of an optimizer</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">def</span> <span class="nf">_reset_optimizer</span><span class="p">(</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">optimizer</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">,</span> <span class="n">net_parameters</span><span class="p">:</span> <span class="n">Generator</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to recreate a new instance of</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    the optimizer passed as input (via introspection)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    with the same configuration and bound to the</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    network parameters of a model</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        optimizer: the optimizer to clone</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        net_parameters: iterator obtained calling .parameters() from a pytorch module</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        a new instance of an optimizer</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">optimizer_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">optimizer_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">name</span><span class="p">:</span> <span class="n">value</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">param_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;params&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="p">}</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer_class</span><span class="p">(</span><span class="n">net_parameters</span><span class="p">,</span> <span class="o">**</span><span class="n">optimizer_params</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">return</span> <span class="n">optimizer</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="tcbench.modeling.methods.trainer_factory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">trainer_factory</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Helper function to instanciate trainer objects</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>either "monolithic" or "simclr" or "xgboost"</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>args</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>positional arguments to use when instanciating the class (if any)</p></td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>key/value arguments to use when instanciating the class (if any)</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>a trainer object</p>
</details>
      <details class="quote">
        <summary>Source code in <code>tcbench/modeling/methods.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1305" name="__codelineno-0-1305"></a><span class="k">def</span> <span class="nf">trainer_factory</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to instanciate trainer objects</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">        method: either &quot;monolithic&quot; or &quot;simclr&quot; or &quot;xgboost&quot;</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">        args: positional arguments to use when instanciating the class (if any)</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">        kwargs: key/value arguments to use when instanciating the class (if any)</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">    Return:</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">        a trainer object</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>    <span class="k">return</span> <span class="n">METHOD_CLASSES</span><span class="p">[</span><span class="n">method</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                

<style>
// Do whatever changes you need here

.jp-RenderedHTMLCommon p {
    margin: 0pt;
}

.jupyter-wrapper .jp-CodeCell .jp-Cell-inputWrapper .jp-InputPrompt {
    display: none;
}

.jupyter-wrapper .jp-CodeCell .jp-Cell-outputWrapper .jp-OutputPrompt {
    display: none;
}

.jupyter-wrapper .jp-OutputArea-output pre {
    border-left: solid 5px #e0e0e0;
    padding-left: 5pt;
}

</style>

<script>
tags = document.getElementsByClassName("md-nav__link");
for (var idx=0; idx < tags.length; idx++) {
    //if (item.hasAttribute("href") && item.attributes["href"].textContent.endsWith("ipynb")) {
    if (tags[idx].innerText.includes("HIDETHIS")) {
        tags[idx].style.display = "none";
    }
}
</script>



              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../tcbench_modeling_losses/" class="md-footer__link md-footer__link--prev" aria-label="Previous: losses" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                losses
              </div>
            </div>
          </a>
        
        
          
          <a href="../tcbench_modeling_utils/" class="md-footer__link md-footer__link--next" aria-label="Next: utils" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                utils
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.expand", "navigation.tabs.sticky", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>